@page "/products/reviews/{id}"
@model FrontEnd.Pages.Products.ReviewsModel
@{
    ViewData["Title"] = "All Reviews";
}
<div class="row">
    <div class="col-lg-12">                            
        <div class="card">                                
            <div class="card-body">
                <div class="row">
                    <div class="col-xl-2"></div>
                    <div class="col-xl-8">
                        <div class="justify-center flex">
                            <img src="@Model.Product.Image1" alt="img-1" class="img-fluid mx-auto d-block tab-img rounded" 
                            data-zoom="@Model.Product.Image1" width="260" height="260">                                                                                             
                        </div>
                    </div>
                    <div class="col-xl-2"></div>
                </div>
                <div class="row">
                    <div class="col-xl-2"></div>
                    <div class="col-xl-3">
                        <h4>Customer Reviews</h4>
                    </div>
                </div>
                <div class="row">                                        
                    <div class="col-xl-2"></div>
                    <div class="col-xl-2"> 
                        <span class="total-reviews-72">@Model.RatingAverage</span>
                        <span class="total-reviews-36">&nbsp;out of&nbsp;</span>
                        <span class="total-reviews-72">5</span>
                        <br>
                        <div class="d-inline-flex">
                            <div class="text-muted me-3">
                                <span class="mdi mdi-star @(Model.RatingAverage > 0 ? "text-warning" : "text-muted")"></span>
                                <span class="mdi mdi-star @(Model.RatingAverage > 1 ? "text-warning" : "text-muted")"></span>
                                <span class="mdi mdi-star @(Model.RatingAverage > 2 ? "text-warning" : "text-muted")"></span>
                                <span class="mdi mdi-star @(Model.RatingAverage > 3 ? "text-warning" : "text-muted")"></span>
                                <span class="mdi mdi-star @(Model.RatingAverage > 4 ? "text-warning" : "text-muted")"></span>
                            </div>
                            <div class="text-muted">
                                @(Model.ReviewList.Count() == 1 ? "1 Review" : @Model.ReviewList.Count() + " Reviews")
                             </div>
                        </div>
                        <ol class="total-reviews-list">
                            @{
                                int fivePercent = Model.ReviewList.Where(u => u.Rating == 5).Count() * 100 / Model.ReviewList.Count();
                                int fourPercent = Model.ReviewList.Where(u => u.Rating == 4).Count() * 100 / Model.ReviewList.Count();
                                int threePercent = Model.ReviewList.Where(u => u.Rating == 3).Count() * 100 / Model.ReviewList.Count();
                                int twoPercent = Model.ReviewList.Where(u => u.Rating == 2).Count() * 100 / Model.ReviewList.Count();
                                int onePercent = Model.ReviewList.Where(u => u.Rating == 1).Count() * 100 / Model.ReviewList.Count();
                            }
                            <li>
                                <div class="total-reviews-list-flex">
                                    <span style="text-align: left; text-decoration: underline; width: 3rem;">5 stars</span>
                                    <span style="flex-grow: 1">
                                        <span class="total-reviews-progress" style="height: 5px;">
                                            <span class="total-reviews-progressbar" role="progressbar" style="width: @fivePercent%" aria-valuenow="@fivePercent" aria-valuemin="0" aria-valuemax="100"></span>
                                        </span>
                                    </span>                                                        
                                    <span class="total-reviews-counts">(@Model.ReviewList.Where(u=>u.Rating == 5).Count())</span>
                                                                                                              
                                </div>                                                    
                            </li>
                            <li>
                                <div class="total-reviews-list-flex">
                                    <span style="text-align: left; text-decoration: underline; width: 3rem;">4 stars</span>
                                    <span style="flex-grow: 1">
                                        <span class="total-reviews-progress" style="height: 5px;">
                                            <span class="total-reviews-progressbar" role="progressbar" style="width: @fourPercent%" aria-valuenow="@fourPercent" aria-valuemin="0" aria-valuemax="100"></span>
                                        </span>
                                    </span>
                                    <span class="total-reviews-counts">(@Model.ReviewList.Where(u=>u.Rating == 4).Count())</span>
                                </div>                                                    
                            </li>
                            <li>
                                <div class="total-reviews-list-flex">
                                    <span style="text-align: left; text-decoration: underline; width: 3rem;">3 stars</span>
                                    <span style="flex-grow: 1">
                                        <span class="total-reviews-progress" style="height: 5px;">
                                            <span class="total-reviews-progressbar" role="progressbar" style="width: @threePercent%" aria-valuenow="@threePercent" aria-valuemin="0" aria-valuemax="100"></span>
                                        </span>
                                    </span>
                                    <span class="total-reviews-counts">(@Model.ReviewList.Where(u=>u.Rating == 3).Count())</span>
                                </div>                                                    
                            </li>
                            <li>
                                <div class="total-reviews-list-flex">
                                    <span style="text-align: left; text-decoration: underline; width: 3rem;">2 stars</span>
                                    <span style="flex-grow: 1">
                                        <span class="total-reviews-progress" style="height: 5px;">
                                            <span class="total-reviews-progressbar" role="progressbar" style="width: @twoPercent%" aria-valuenow="@twoPercent" aria-valuemin="0" aria-valuemax="100"></span>
                                        </span>
                                    </span>
                                    <span class="total-reviews-counts">(@Model.ReviewList.Where(u=>u.Rating ==2).Count())</span>
                                </div>                                                    
                            </li>
                            <li>
                                <div class="total-reviews-list-flex">
                                    <span style="text-align: left; text-decoration: underline; width: 3rem;">1 star</span>
                                    <span style="flex-grow: 1">
                                        <span class="total-reviews-progress" style="height: 5px;">
                                            <span class="total-reviews-progressbar" role="progressbar" style="width: @onePercent%" aria-valuenow="@onePercent" aria-valuemin="0" aria-valuemax="100"></span>
                                        </span>
                                    </span>
                                    <span class="total-reviews-counts">(@Model.ReviewList.Where(u=>u.Rating == 1).Count())</span>
                                </div>                                                    
                            </li>
                        </ol>       
                    </div>
                    <div class="col-xl-1">
                        <div class="vr my-6 ms-2" style="height: 75%">

                        </div>
                    </div>
                    <div class="col-xl-5" style="margin-left: -5rem">
                        <div class="row">
                            <div class="col-lg-5">
                            @if (Model.PositiveReview != null)
                            {
                                
                                <h5 class="font-size-15 mt-5">Most Helpful Positive Review</h5>
                                <br>
                                <div class="card">
                                    <div class="card-body">
                                        <div class="d-inline-flex">
                                            <div class="text-muted me-3">
                                                <span class="mdi mdi-star @(Model.PositiveReview.Rating > 0 ? "text-warning" : "text-muted")"></span>
                                                <span class="mdi mdi-star @(Model.PositiveReview.Rating > 1 ? "text-warning" : "text-muted")"></span>
                                                <span class="mdi mdi-star @(Model.PositiveReview.Rating > 2 ? "text-warning" : "text-muted")"></span>
                                                <span class="mdi mdi-star @(Model.PositiveReview.Rating > 3 ? "text-warning" : "text-muted")"></span>
                                                <span class="mdi mdi-star @(Model.PositiveReview.Rating > 4 ? "text-warning" : "text-muted")"></span>
                                            </div>
                                        </div>
                                        <br>
                                        <br>
                                        <h5 class="fw-bolder-bolder font-size-16" style="color:black">@Model.PositiveReview.Title</h5>
                                        <p class="text-muted">@Model.PositiveReview.Body</p>
                                            <h5 class="font-size-14 mb-3 fst-italic">@Model.PositiveReview.ApplicationUser.FirstName @Model.PositiveReview.ApplicationUser.LastName</h5>
                                    </div>
                                </div>
                            }
                            </div>
                            <div class="col-lg-2">
                            </div>
                            <div class="col-lg-5">
                                @if (Model.NegativeReview != null)
                                {
                                    <h5 class="font-size-15 mt-5">Most Helpful Negative Review</h5>
                                    <br>
                                    <div class="card">
                                        <div class="card-body">
                                            <div class="d-inline-flex">
                                                <div class="text-muted me-3">
                                                    <span class="mdi mdi-star @(Model.NegativeReview.Rating > 0 ? "text-warning" : "text-muted")"></span>
                                                    <span class="mdi mdi-star @(Model.NegativeReview.Rating > 1 ? "text-warning" : "text-muted")"></span>
                                                    <span class="mdi mdi-star @(Model.NegativeReview.Rating > 2 ? "text-warning" : "text-muted")"></span>
                                                    <span class="mdi mdi-star @(Model.NegativeReview.Rating > 3 ? "text-warning" : "text-muted")"></span>
                                                    <span class="mdi mdi-star @(Model.NegativeReview.Rating > 4 ? "text-warning" : "text-muted")"></span>
                                                </div>
                                            </div>
                                            <br>
                                            <br>
                                            <h5 class="fw-bolder-bolder font-size-16" style="color:black">@Model.NegativeReview.Title</h5>
                                            <p class="text-muted">@Model.NegativeReview.Body</p>
                                            <h5 class="font-size-14 mb-3 fst-italic">@Model.NegativeReview.ApplicationUser.FirstName @Model.NegativeReview.ApplicationUser.LastName</h5>
                                        </div>
                                    </div>
                                }
                            </div>
                        </div>                                            
                    </div>
                    <div class="col-xl-2"></div>
                </div>
                <div class="row">
                    <div class="col-xl-2"></div>
                    <div class="col-xl-8">
                        <hr>
                    </div>
                    <div class="col-xl-2"></div>
                </div>
                <!-- end row -->
                <div class="row">
                    <div class="col-xl-2"></div>
                    <div class="col-xl-8">                                           
                        <div class="mt-4">
                            <h5 class="font-size-14">Reviews : </h5>
                            <div class="d-inline-flex mb-3"></div>
                            <div class="border p-4 rounded mb-0">
                                @foreach (var review in Model.ReviewListFiltered)
                                {
                                    <div class="d-flex border-bottom py-3">
                                        <div class="flex-1">
                                            <div class="d-inline-flex mb-3">
                                                <div class="text-muted me-3">
                                                    <span class="mdi mdi-star @(review.Rating > 0 ? "text-warning" : "text-muted")"></span>
                                                    <span class="mdi mdi-star @(review.Rating > 1 ? "text-warning" : "text-muted")"></span>
                                                    <span class="mdi mdi-star @(review.Rating > 2 ? "text-warning" : "text-muted")"></span>
                                                    <span class="mdi mdi-star @(review.Rating > 3 ? "text-warning" : "text-muted")"></span>
                                                    <span class="mdi mdi-star @(review.Rating > 4 ? "text-warning" : "text-muted")"></span>
                                                </div>
                                            </div>
                                            <h5 class="font-size-17 mb-3">@review.Title</h5>
                                            <p class="text-muted mb-2">@review.Body</p>
                                            <br>
                                            <h5 class="font-size-14 mb-3 fst-italic">@review.ApplicationUser.FirstName @review.ApplicationUser.LastName</h5>                                                            
                                            <ul class="list-inline product-review-link mb-0">
                                                <li class="list-inline-item">
                                                @if (Model.HelpfulReviewList != null)
                                                {
                                                    if (Model.HelpfulReviewList.Where(u => u.ReviewId == review.Id).Count() > 0)
                                                    {
                                                        <p>@Model.HelpfulReviewList.Where(u=> u.ReviewId == review.Id).Count() people found this helpful</p>
                                                    }
                                                    if (Model.HelpfulReviewListUser != null)
                                                    {
                                                        if (Model.HelpfulReviewListUser.Where(u => u.ReviewId == review.Id).Count() > 0)
                                                        {
                                                            <a asp-page-handler="unhelpful" asp-route-id="@review.Id" asp-route-product="@review.ProductId" class="text-primary"><i class="mdi mdi-thumb-up text-primary align-middle me-1"></i> Helpful</a>
                                                        }
                                                        else
                                                        {
                                                            <a asp-page-handler="helpful" asp-route-id="@review.Id" asp-route-product="@review.ProductId"><i class="mdi mdi-thumb-up align-middle me-1"></i> Helpful</a>
                                                        }
                                                    }
                                                }
                                                </li>
                                            </ul>
                                        </div>
                                        <p class="float-sm-end font-size-12">@review.CreatedDate</p>
                                    </div>
                                } 
                            </div>
                        </div>
                        <br>
                        <div class="justify-center items-center flex">
                            <ul class="pagination pagination-rounded mb-sm-0">
                                @if(Model.ShowPrevious){
                                    <li class="page-item">
                                        <a asp-page="/products/reviews" asp-route-pageIndex="@(Model.PageIndex - 1)" class="page-link"><i class="mdi mdi-chevron-left"></i></a>
                                    </li>
                                }                                
                                @for (var i = 1; i <= Model.TotalPages; i++ )
                                {
                                    <li class="page-item @(i == Model.PageIndex ? "active" : "")">
                                        <a asp-page="/products/reviews" asp-route-pageIndex="@i" class="page-link">@i</a>
                                    </li>
                                }
                                @if (Model.ShowNext) {
                                    <li class="page-item">
                                        <a asp-page="/products/reviews" asp-route-pageIndex="@(Model.PageIndex + 1)" class="page-link"><i class="mdi mdi-chevron-right"></i></a>
                                    </li>
                                }
                            </ul>
                        </div>
                    </div>
                                        
                    <div class="col-xl-2"></div>
                </div>                                    
            </div>
        </div>
        <!-- end card -->
    </div>
</div>
